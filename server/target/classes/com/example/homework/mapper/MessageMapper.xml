<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.homework.mapper.MessageMapper">

    <!-- 定义Message类对应的resultMap -->
    <resultMap id="MessageResultMap" type="com.example.homework.pojo.Message">
        <id property="sender_id" column="sender_id" />
        <result property="recipient_id" column="recipient_id" />
        <result property="content" column="content" />
        <result property="timestamp" column="timestamp" />
    </resultMap>

<!--    &lt;!&ndash; 添加新消息 &ndash;&gt;-->
<!--    <insert id="add" parameterType="com.example.homework.Message">-->
<!--        INSERT INTO messages (sender_id, recipient_id, content, timestamp)-->
<!--        VALUES (#{sender_id}, #{recipient_id}, #{content}, #{timestamp})-->
<!--    </insert>-->

    <!-- 列出特定对话的消息 -->
    <select id="list" parameterType="com.example.homework.pojo.Message" resultMap="MessageResultMap">
        SELECT * FROM messages
        WHERE (sender_id = #{sender_id} AND recipient_id = #{recipient_id})
           OR(sender_id = #{recipient_id} AND recipient_id = #{sender_id})
        ORDER BY timestamp DESC
    </select>

    <!-- 列出特定用户的所有消息 -->
    <select id="userlist" parameterType="com.example.homework.pojo.Message" resultMap="MessageResultMap">
        SELECT * FROM messages
        WHERE sender_id = #{sender_id} OR recipient_id = #{sender_id}
    </select>

</mapper>